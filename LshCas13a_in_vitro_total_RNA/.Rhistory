if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Gviz")
install.packages("RCurl")
BiocManager::install("GenomicRanges")
install.packages("RCurl")
install.packages("RCurl")
BiocManager::install("GenomicRanges")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Gviz")
BiocManager::install("rtracklayer")
BiocManager::install("rtracklayer")
BiocManager::install("Rsubread")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Gviz")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("Gviz")
install.packages("svglite")
install.packages("svglite")
install.packages("svglite")
install.packages("tydiverse")
install. packages("tidyverse")
install.packages("tidyverse")
library(data.table)
library(dplyr)
setwd("~/data/DroAr_data/")
#file with RPKM normalized read counts table
read_counts_normalized <- "Results/read_counts_RPKM_normalized.tsv"
#load read counts table
read_counts_normalized.dt <- fread(read_counts_normalized)
library(data.table)
library(dplyr)
setwd("~/data/Drobysheva_et_al_2020/")
#file with RPKM normalized read counts table
read_counts_normalized <- "Results/read_counts_RPKM_normalized.tsv"
#load read counts table
read_counts_normalized.dt <- fread(read_counts_normalized)
#classification of genes by time classes
#select ORFs
read_counts_normalized.dt_orfs <- read_counts_normalized.dt %>%
filter(!grepl("igr", feature))
#calculate logFC values between neighbor time points
logfc_df <- data.table(feature = counts.rpkms$feature,
logfc_40vs90 = log10(counts.rpkms$`90`)-log10(counts.rpkms$`40`),
logfc_90vs140 = log10(counts.rpkms$`140`)-log10(counts.rpkms$`90`),
logfc_140vs190 = log10(counts.rpkms$`190`)-log10(counts.rpkms$`140`))
library(dplyr)
setwd("~/data/Drobysheva_et_al_2020/")
#file with RPKM normalized read counts table
read_counts_normalized <- "Results/read_counts_RPKM_normalized.tsv"
#load read counts table
read_counts_normalized.dt <- fread(read_counts_normalized)
#classification of genes by time classes
#select ORFs
read_counts_normalized.dt_orfs <- read_counts_normalized.dt %>%
filter(!grepl("igr", feature))
#calculate logFC values between neighbor time points
logfc_df <- data.table(feature = counts.rpkms$feature,
logfc_40vs90 = log10(counts.rpkms$`90`)-log10(counts.rpkms$`40`),
logfc_90vs140 = log10(counts.rpkms$`140`)-log10(counts.rpkms$`90`),
logfc_140vs190 = log10(counts.rpkms$`190`)-log10(counts.rpkms$`140`))
logFC.dt <- data.table(feature = read_counts_normalized.dt_orfs$feature,
logfc_40vs90 = with(read_counts_normalized.dt_orfs, log10(t90)-log10(t40)),
logfc_90vs140 = with(read_counts_normalized.dt_orfs, log10(t140)-log10(t90)),
logfc_90vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t90)),
logfc_140vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t140)))
library(data.table)
library(dplyr)
setwd("~/data/Drobysheva_et_al_2020/")
#file with RPKM normalized read counts table
read_counts_normalized <- "Results/read_counts_RPKM_normalized.tsv"
#load read counts table
read_counts_normalized.dt <- fread(read_counts_normalized)
#classification of genes by time classes
#select ORFs
read_counts_normalized.dt_orfs <- read_counts_normalized.dt %>%
filter(!grepl("igr", feature))
#calculate logFC values between neighbor time points
logfc_df <- data.table(feature = counts.rpkms$feature,
logfc_40vs90 = log10(counts.rpkms$`90`)-log10(counts.rpkms$`40`),
logfc_90vs140 = log10(counts.rpkms$`140`)-log10(counts.rpkms$`90`),
logfc_140vs190 = log10(counts.rpkms$`190`)-log10(counts.rpkms$`140`))
#calculate logFC values between neighbor time points
logFC.dt <- data.table(feature = read_counts_normalized.dt_orfs$feature,
logfc_40vs90 = with(read_counts_normalized.dt_orfs, log10(t90)-log10(t40)),
logfc_90vs140 = with(read_counts_normalized.dt_orfs, log10(t140)-log10(t90)),
logfc_90vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t90)),
logfc_140vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t140)))
logFC.dt <- data.table(feature = read_counts_normalized.dt_orfs$feature,
logfc_40vs90 = with(read_counts_normalized.dt_orfs, log10(t90)-log10(t40)),
logfc_90vs140 = with(read_counts_normalized.dt_orfs, log10(t140)-log10(t90)),
logfc_90vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t90)),
logfc_140vs190 = with(read_counts_normalized.dt_orfs, log10(t190)-log10(t140)))
#classify ORFs according to the differences between different times of infection
putative_early_genes <- logFC.dt[logfc_90vs140 < 0 & logfc_140vs190 < 0]$feature
putative_middle_genes <- logFC.dt[logfc_90vs190 > 0 & logfc_90vs190 <= 1]$feature
putative_late_genes <- logFC.dt[logfc_90vs190 > 1]$feature
read_counts_normalized.dt_orfs.time_classes <- read_counts_normalized.dt_orfs %>%
mutate(time_class = ifelse(feature %in% putative_early_genes, "early",
ifelse(feature %in% putative_middle_genes, "middle",
ifelse(feature %in% putative_late_genes, "late", "ND"))))
View(read_counts_normalized.dt_orfs.time_classes)
fwrite(read_counts_normalized.dt_orfs.time_classes, "Results/gene_classes_and_RPKMs.tsv", sep = "\t", quote = F, row.names = F)
View(read_counts_normalized.dt_orfs)
View(logFC.dt)
library(data.table)
library(dplyr)
library(reshape2)
library(ggplot2)
setwd("~/data/Drobysheva_et_al_2020/")
#File with normalized transcript abundances and time classes
classified_ORFs <- "Results/gene_classes_and_RPKMs.tsv"
#Annotation file
phi14_2_annotation <- "annotation/NC_021806_annotation_by_EVK.gff3"
#transcript abundances table
tr_ab_table <- "Results/read_counts_RPKM_normalized.tsv"
#load data
classified_ORFs_Rif_minus.dt <- fread(classified_ORFs) %>%
select(-c("without_phage", "t40_Rif", "t90_Rif", "t140_Rif", "t190_Rif")) #remove uninfected sample and Rif+ samples
#g107 ORF is located within middle genes segment and we suspect that this gene is also should belong to middle gene class
classified_ORFs_Rif_minus.dt[feature == "g107"]$time_class <- "middle"
#normalize transcript abundances for each ORF to max. transcript abundance across all time points
classified_ORFs_Rif_minus.dt_maxnorm <- classified_ORFs_Rif_minus.dt
classified_ORFs_Rif_minus.dt_maxnorm[,c("t40", "t90", "t140", "t190")] <- classified_ORFs_Rif_minus.dt_maxnorm[,c("t40", "t90", "t140", "t190")]/apply(classified_ORFs_Rif_minus.dt_maxnorm[,c("t40", "t90", "t140", "t190")], 1, max)
classified_ORFs_Rif_minus.dt_maxnorm.melted <- melt(classified_ORFs_Rif_minus.dt_maxnorm, id.vars = c("feature", "time_class"), variable.name = "time_point", value.name = "abundance") %>%
mutate(time_class = factor(time_class, levels = c("early", "middle", "late")))
#Draw plot
tr_abundances <- ggplot(classified_ORFs_Rif_minus.dt_maxnorm.melted, aes(x = time_point, y = abundance, group = feature, colour = feature)) +
geom_line() +
facet_grid(cols = vars(time_class)) +
theme(legend.position = "none") +
xlab(label = "Time post-infection, min") +
ylab(label = "Transcript abundances, % of max. expression") +
scale_x_discrete(labels=c("40", "90", "140", "190")) +
theme_bw() +
theme(legend.position="none")
ggplot(classified_ORFs_Rif_minus.dt_maxnorm.melted, aes(x = time_point, y = abundance, group = feature, colour = feature)) +
geom_line() +
facet_grid(cols = vars(time_class)) +
theme(legend.position = "none") +
xlab(label = "Time post-infection, min") +
ylab(label = "Transcript abundances, % of max. expression") +
scale_x_discrete(labels=c("40", "90", "140", "190")) +
theme_bw() +
theme(legend.position="none")
ggsave("Results/Pictures/Transcript_abundances_Rif_minus.svg", tr_abundances)
#Draw plot of transcript abundances in Rif+ samples normalized to local max. values in Rif- samples
classified_ORFs.dt <- fread(classified_ORFs) %>%
select(-without_phage)
classified_ORFs.dt[feature == "g107"]$time_class <- "middle"
classified_ORFs.dt_Rif_plus_norm_to_Rif_minus <- classified_ORFs.dt
classified_ORFs.dt_Rif_plus_norm_to_Rif_minus[,c("t40_Rif", "t90_Rif", "t140_Rif", "t190_Rif")] <-
classified_ORFs.dt_Rif_plus_norm_to_Rif_minus[,c("t40_Rif", "t90_Rif", "t140_Rif", "t190_Rif")]/apply(classified_ORFs.dt_Rif_plus_norm_to_Rif_minus[,c("t40", "t90", "t140", "t190")], 1, max)
classified_ORFs.dt_Rif_plus_norm_to_Rif_minus <- classified_ORFs.dt_Rif_plus_norm_to_Rif_minus %>%
select(-c("t40", "t90", "t140", "t190"))
classified_ORFs.dt_Rif_plus_norm_to_Rif_minus.melted <- melt(classified_ORFs.dt_Rif_plus_norm_to_Rif_minus, id.vars = c("feature", "time_class"), variable.name = "time_point", value.name = "abundance")%>%
mutate(time_class = factor(time_class, levels = c("early", "middle", "late")))
tr_abundances_rifplus <- ggplot(classified_ORFs.dt_Rif_plus_norm_to_Rif_minus.melted, aes(x = time_point, y = abundance, group = feature)) +
geom_line(aes(colour=time_class, alpha=feature), show.legend = FALSE) +
scale_colour_manual(values = c(early="darkgreen", middle="purple", late="blue", guide="none")) +
facet_wrap(~time_class, ncol=3) +
scale_x_discrete(labels=c("40", "90", "140", "190")) +
xlab(label = "Time after infection, min") +
ylab(label = "Transcript abundance, %")
ggsave("Results/Pictures/Transcript_abundances_Rif_plus_norm_to_Rif_minus.svg", tr_abundances_rifplus)
ggplot(classified_ORFs.dt_Rif_plus_norm_to_Rif_minus.melted, aes(x = time_point, y = abundance, group = feature)) +
geom_line(aes(colour=time_class, alpha=feature), show.legend = FALSE) +
scale_colour_manual(values = c(early="darkgreen", middle="purple", late="blue", guide="none")) +
facet_wrap(~time_class, ncol=3) +
scale_x_discrete(labels=c("40", "90", "140", "190")) +
xlab(label = "Time after infection, min") +
ylab(label = "Transcript abundance, %")
ggsave("Results/Pictures/Transcript_abundances_Rif_plus_norm_to_Rif_minus.svg", tr_abundances_rifplus)
library(Gviz)
library(rtracklayer)
options(ucscChromosomeNames = F)
tr_ab_table.dt <- fread(tr_ab_table) %>%
select(-c("without_phage", "t40_Rif", "t90_Rif", "t140_Rif", "t190_Rif")) #remove uninfected sample and Rif+ samples
tr_ab_table.dt_localmaxnorm <- tr_ab_table.dt
tr_ab_table.dt_localmaxnorm[,c("t40", "t90", "t140", "t190")] <- tr_ab_table.dt_localmaxnorm[,c("t40", "t90", "t140", "t190")]/apply(tr_ab_table.dt_localmaxnorm[,c("t40", "t90", "t140", "t190")], 1, max)
phi14_2_annotation.GR <- readGFFAsGRanges(phi14_2_annotation)
phi14_2_annotation.track <- AnnotationTrack(start = phi14_2_annotation.GR@ranges@start,
width = phi14_2_annotation.GR@ranges@width,
chromosome = "NC_021806.1",
strand = as.character(phi14_2_annotation.GR@strand),
id = phi14_2_annotation.GR$ID,
stacking="dense",
fill = "grey",
col = "black",
lex = 10,
lty = 1,
shape = "fixedArrow",
arrowHeadWidth = 100,
lwd = 1,
fontcolor.feature="black",
rotation.item = 90,
cex = 2,
labelPos = "below")
axisTrack <- GenomeAxisTrack(cex = 2, labelPos="below", size = 1)
hm_data <- GRanges(seqnames = phi14_2_annotation.GR@seqnames, ranges = phi14_2_annotation.GR@ranges, strand = rep("*", length(phi14_2_annotation.GR@ranges)))
hm_data$feature <- phi14_2_annotation.GR$ID
#Draw heatmap normalized to local max.
values(hm_data) <- merge(hm_data, tr_ab_table.dt_localmaxnorm, by.x = "feature", sort = F)[c("t40", "t90", "t140", "t190")]
dTrack <- DataTrack(hm_data,
name = "rpkm/local_max(rpkms)",
type = "heatmap",
showSampleNames = T)
plotTracks(c(phi14_2_annotation.track, axisTrack, dTrack), featureAnnotation = "id")
svg("Results/Pictures/transcript_abundances_heatmap_norm_on_norm_on_local_max.svg", width = 150, height = 40)
plotTracks(c(phi14_2_annotation.track, axisTrack, dTrack), featureAnnotation = "id")
dev.off()
#maximum value across transcript abundances of all ORFs across all time points
global_max_value <- max(apply(tr_ab_table.dt[,c("t40", "t90", "t140", "t190")], 1, max))
tr_ab_table.dt_globalmaxnorm <- tr_ab_table.dt
tr_ab_table.dt_globalmaxnorm[,c("t40", "t90", "t140", "t190")] <- tr_ab_table.dt_globalmaxnorm[,c("t40", "t90", "t140", "t190")]/global_max_value
hm_data <- GRanges(seqnames = phi14_2_annotation.GR@seqnames, ranges = phi14_2_annotation.GR@ranges, strand = rep("*", length(phi14_2_annotation.GR@ranges)))
hm_data$feature <- phi14_2_annotation.GR$ID
#Draw heatmap normalized to global max.
values(hm_data) <- merge(hm_data, tr_ab_table.dt_globalmaxnorm, by.x = "feature", sort = F)[c("t40", "t90", "t140", "t190")]
dTrack <- DataTrack(hm_data,
name = "rpkm/local_max(rpkms)",
type = "heatmap",
showSampleNames = T)
svg("Results/Pictures/transcript_abundances_heatmap_norm_on_norm_on_global_max.svg", width = 150, height = 40)
plotTracks(c(phi14_2_annotation.track, axisTrack, dTrack), featureAnnotation = "id")
dev.off()
plotTracks(c(phi14_2_annotation.track, axisTrack, dTrack), featureAnnotation = "id")
library(dplyr)
library(tidyr)
library(Biostrings)
setwd("~/data/LshCas13a_RNA_cleavage/LshCas13a_in_vitro_total_RNA/")
#build source tables for tRNAs
RefSeqs <- readDNAStringSet("Reference_sequences/NC_000913.3.fasta", format = "fasta")
chromosome = RefSeqs$NC_000913.3
tRNA_annotation <- read.delim("Annotations/NC_000913.3_Aragorn_tRNAs_renamed.tsv",
sep = "\t", col.names = c("tRNA_type", "tRNA_start", "tRNA_end", "tRNA_strand", "AC_pos", "AC"))
tRNA_tables_dir <- "Results/Tables/Source_tables/tRNA_source_tables"
dir.create(tRNA_tables_dir, recursive = T)
build_tRNA_table <- function(N5E_table, tRNA_type, tRNA_start, tRNA_end, tRNA_strand, AC_pos, output_dir) {
print(tRNA_type)
tRNA_table <- N5E_table[N5E_table$SeqID == "NC_000913.3" & N5E_table$Strand == tRNA_strand & N5E_table$Pos >= tRNA_start & N5E_table$Pos <= tRNA_end, ]
if (tRNA_strand == "+") {
tRNA_table <- tRNA_table %>%
rowwise() %>%
mutate(., Letter = as.character(chromosome[Pos])) %>%
mutate(., Letter = sub("T", "U", Letter)) %>%
mutate(., Pos = Pos-tRNA_start+1) %>%
arrange(., Pos)
} else {
tRNA_table <- tRNA_table %>%
rowwise() %>%
mutate(., Letter = as.character(complement(chromosome)[Pos])) %>%
mutate(., Letter = sub("T", "U", Letter)) %>%
mutate(., Pos = tRNA_end-Pos+1) %>%
arrange(., Pos)
}
AC_coords <- seq(AC_pos, AC_pos+2)
output_file <- file.path(output_dir, paste0(tRNA_type, "_", paste(c(tRNA_start, tRNA_end, AC_coords), sep = "_", collapse = "_"), ".tsv"))
write.table(tRNA_table, file = output_file, sep = "\t", quote = F, row.names = F)
}
N5E_counts_table <- read.delim("Results/Tables/Merged_ends_counts/N5E_T_vs_NT_CPM_normalized.tsv.gz",
sep = "\t",
header = T,
stringsAsFactors = F)
